<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <title>Anigrams</title>
  <meta name="generator" content="Jekyll v3.9.2" />
  <meta property="og:title" content="Anigrams" />
  <meta property="og:locale" content="en_US" />
  <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
  <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
  <link rel="canonical" href="http://localhost:4000/about/" />
  <meta property="og:url" content="http://localhost:4000/about/" />
  <meta property="og:site_name" content="Anigrams" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary" />
  <meta property="twitter:title" content="Anigrams" />
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "description": "Anigrams",
      "headline": "Anigrams",
      "name": "Anigrams",
      "url": "http://localhost:4000/about/"
    }
  </script>
  <!-- End Jekyll SEO tag -->
  <link rel="stylesheet" href="main.css">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Your awesome title" />
</head>

<body>
  <header class="site-header" role="banner">

    <div class="header-wrapper">
      <a class="title" rel="author" href="/">Anigrams</a>
      <div class="flex-container">
        <button class="link-button" role="button" onClick="openModal('rulesModal')">Rules</button>
        <button class="link-button" role="button">Yesterday</button>
      </div>
    </div>
  </header>
  <main class="page-content" aria-label="Content">
    <div class="wrapper">
      <article class="post">
        <!-- <div id="incorrectFeedback" class="incorrectFeedback">Word not in dictionary</div> -->

        <div id="solutionArea"></div>

        <!-- <div id="wordTarget"></div> -->
        <div class="divider"></div>
        <div id="tileArea"></div>

        <div class="emoji-button-menu" onClick="() => {}">
          <button class="emoji-button" role="button" onClick="goback()">‚¨ÖÔ∏è</button>
          <button class="emoji-button" role="button" onClick="shuffle()">üîÑ</button>
        </div>

        <div class="buttonMenu">
          <button class="button-84" role="button" onClick="showFirstLetter()">Show first letter</button>
          <!-- <button class="button-84" role="button" onClick="reset()">Reset</button> -->
        </div>

        <!-- <div id="prevAnswers"></div> -->

        <div id="congratsModal" class="modal">
          <div class="modal-content">
            <p>Congrats! You win!</p>
          </div>
        </div>

        <div id="rulesModal" class="modal">
          <div class="modal-content">
            <span class="close" onClick="closeModal('rulesModal')">&times;</span>
            <p>Here are some rules and other info!</p>
          </div>
        </div>
      </article>

    </div>
  </main>
  <footer class="site-footer h-card">
    <data class="u-url" href="/"></data>

    <div class="wrapper">

      <h2 class="footer-heading">Your awesome title</h2>

      <div class="footer-col-wrapper">
        <div class="footer-col footer-col-1">
          <ul class="contact-list">
            <li class="p-name">Your awesome title</li>
            <li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li>
          </ul>
        </div>

        <div class="footer-col footer-col-2">
          <ul class="social-media-list">
            <li><a href="https://github.com/jekyll"><svg class="svg-icon">
                  <use xlink:href="/assets/minima-social-icons.svg#github"></use>
                </svg> <span class="username">jekyll</span></a></li>
            <li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon">
                  <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
                </svg> <span class="username">jekyllrb</span></a></li>
          </ul>
        </div>

        <div class="footer-col footer-col-3">
          <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
        </div>
      </div>

    </div>

  </footer>
  <script>
    var solution = [
      ['sext'],
      ['texts'],
      ['sextet'],
      ['extents'],
      ['existent'],
      ['sixteenth']
    ];
    var currentWord = "";
    var currentRound = 0;
    var emojiMapping = {
      0: 'ü¶ú',
      1: 'ü¶í',
      2: 'üê¨',
      3: 'ü¶â',
      4: 'üêô',
      5: 'üêê',
    }

    // var allAnswers = document.getElementById('prevAnswers');
    for (var i = 0; i < solution.length; i++) {
      // var answer = document.createElement('div');
      // answer.className = "answerRow";
      for (var j = 0; j < solution[i][0].length; j++) {
        // emojiTile = document.createElement('div');
        // flipper = document.createElement('div');
        // front = document.createElement('div');
        // back = document.createElement('div');
        // emojiTile.className = "tile showTile flip-container";
        // flipper.className = "flipper";
        // front.className = "front";
        // back.className = `back back-${i}`;
        // front.innerText = emojiMapping[i];
        // back.innerText = 'X';
        // flipper.appendChild(front);
        // flipper.appendChild(back);
        // emojiTile.appendChild(flipper);
        // answer.appendChild(emojiTile)

        var solutionRow = document.createElement('div');
        solutionRow.className = "solution-row";
        numberDiv = document.createElement('div');
        numberDiv.innerText = i + 4;
        solutionCell = document.createElement('div');
        solutionCell.id = `solution-${i + 4}`;
        solutionCell.className = "solution-cell"
        if (i === 0) {
          solutionCell.classList.add('active-cell');
        }
        solutionRow.appendChild(numberDiv);
        solutionRow.appendChild(solutionCell);
      }
      // allAnswers.appendChild(answer);
      document.getElementById('solutionArea').appendChild(solutionRow);
    }

    for (var i = 0; i < solution[0][0].length; i++) {
      var newTile = document.createElement('div');
      newTile.className = "tile showTile";
      newTile.addEventListener('click', clickTile);
      newTile.innerText = solution[0][0][i];
      document.getElementById('tileArea').appendChild(newTile);
    }
    for (var i = 1; i < solution.length; i++) {
      emojiTile = document.createElement('div');
      flipper = document.createElement('div');
      front = document.createElement('div');
      back = document.createElement('div');
      emojiTile.className = "tile showTile flip-container emoji-tile";
      flipper.className = "flipper";
      front.className = "front";
      back.className = `back back-${i}`;
      front.innerText = emojiMapping[i];
      back.innerText = 'X';
      flipper.appendChild(front);
      flipper.appendChild(back);
      emojiTile.appendChild(flipper);
      document.getElementById('tileArea').appendChild(emojiTile)
    }
    shuffle();

    function goback() {
      if (currentWord !== "") {
        // var tile = document.getElementById('wordTarget').lastChild;
        // var firstBlank = document.querySelector('.hidden-tile');
        // firstBlank.innerText = tile.innerText;
        // firstBlank.classList.remove('hidden-tile');
        // firstBlank.addEventListener('click', clickTile);
        // tile.remove();
        var lastLetter = currentWord[currentWord.length - 1];
        currentWord = currentWord.slice(0, -1)
        document.querySelector(`#solution-${currentRound + 4}`).innerText = currentWord;
        var usedTiles = document.querySelectorAll('.used-tile');
        var tile = [...usedTiles].filter((usedTile) => usedTile.innerText === lastLetter)[0];
        tile.classList.remove('used-tile');
      }
    }

    document.addEventListener('keydown', (e) => {
      if (!e.repeat) {
        if (e.key === 'Backspace') {
          goback();
          return;
        }
        var index = [...document.getElementById('tileArea').children].map((child) => child.classList.contains('used-tile') ? '?' : child.innerText.toLowerCase()).indexOf(e.key);
        if (index !== -1) {
          document.querySelector(`#tileArea :nth-child(${index + 1})`).click();
        }
      }
    });

    // function getLetterAt(index) {
    //   return letters[index];
    // }
    //
    // function allowDrop(ev) {
    //   if (ev.target.childElementCount === 0) {
    //     ev.preventDefault();
    //   }
    // }
    //
    // function drag(ev) {
    //   ev.dataTransfer.setData("text", ev.target.id);
    //   ev.dataTransfer.setData("dragOrigin", ev.target.parentElement.id);
    // }
    //
    // function drop(ev, el) {
    //   // if (el.childElementCount === 0) {
    //   ev.preventDefault();
    //   var currentChild = el.firstChild;
    //   var data = ev.dataTransfer.getData("text");
    //   el.appendChild(document.getElementById(data));
    //   dragOrigin.appendChild(currentChild);
    // }
    // // }

    function clickTile(ev) {
      // if (document.getElementById('wordTarget').contains(ev.target)) {
      //   return;
      // }
      currentWord += ev.target.innerText;

      document.querySelector(`#solution-${currentRound + 4}`).innerText = currentWord;
      ev.target.classList.add("used-tile");

      // var tileClone = ev.target.cloneNode(true);
      // tileClone.addEventListener('click', clickTile);
      // document.getElementById('wordTarget').appendChild(tileClone);
      // ev.target.innerText = '/';
      // ev.target.removeEventListener('click', clickTile);
      // ev.target.classList.add("hidden-tile");
      // correct word
      if (solution.flat().includes(currentWord.toLowerCase()) && currentWord.length === currentRound + 4) {
        // animate solution word
        // [...document.getElementById('wordTarget').children].forEach((tile) => {
        //   tile.classList.add("bounce");
        // });
        // set solution that player actually went with
        // var emojisToFlip = document.querySelectorAll(`.back-${currentRound}`);
        // emojisToFlip.forEach((emoji, i) => {
        //   emoji.innerText = currentWord[i];
        // });
        // flip the tiles
        // var flipContainers = document.querySelectorAll(".answerRow")[currentRound].children;
        // Array.from(flipContainers).forEach((flipContainer, i) => {
        //   flipContainer.firstChild.classList.add("flip");
        // });
        // change active answer cell


        setTimeout(() => {
          reset(true);
          document.querySelector(`#solution-${currentRound + 4}`).classList.remove("active-cell");
          currentRound++;
          if (currentRound === solution.length) {
            document.getElementById('congratsModal').style.display = "block";
            return;
          }
          document.querySelector(`#solution-${currentRound + 4}`).classList.add("active-cell");
          // document.getElementById('tileArea').appendChild(document.getElementById('tilesWrapper').children[1]);
          var tileToFlip = document.querySelector('.emoji-tile')
          tileToFlip.firstChild.children[1].innerText = findNewLetter(currentRound);
          setTimeout(() => {
            tileToFlip.firstChild.classList.add("flip");
          }, 100);
          setTimeout(() => {
            var newTile = document.createElement('div');
            newTile.className = "tile showTile";
            newTile.addEventListener('click', clickTile);
            newTile.innerText = findNewLetter(currentRound);
            document.getElementById('tileArea').insertBefore(newTile, tileToFlip);
            tileToFlip.remove();
          }, 500);
          // var newTile = document.createElement('div');
          // newTile.className = "tile";
          // newTile.addEventListener('click', clickTile);
          // newTile.innerText = findNewLetter(currentRound);
          // document.getElementById('tileArea').appendChild(newTile);
          // setTimeout(() => newTile.classList.add("showTile"), 100);
        }, 0)
      }
      // incorrect word
      else if (currentWord.length === currentRound + 4) {
        var feedbackMessage = document.createElement('div');
        feedbackMessage.innerText = "Word not in dictionary";
        feedbackMessage.className = "incorrectFeedback";
        // var feedbackMessage = document.getElementById('incorrectFeedback')
        feedbackMessage.classList.add("showIncorrectFeedback");
        document.querySelector('.active-cell').appendChild(feedbackMessage);
        // reset();
        setTimeout(() => feedbackMessage.classList.remove("showIncorrectFeedback"), 300);
        setTimeout(() => reset(), 500);
      }
    }

    function showFirstLetter() {
      if (currentWord.toLowerCase() === solution[currentRound][0][0].toLowerCase()) {
        return;
      }
      reset();
      var index = [...document.getElementById('tileArea').children].map((child) => child.innerText.toLowerCase()).indexOf(solution[currentRound][0][0]);
      document.querySelector(`#tileArea :nth-child(${index + 1})`).click();
    }

    function findNewLetter(round) {
      oldLetters = solution[round - 1][0].split('').sort().join('');
      newLetters = solution[round][0].split('').sort().join('');
      for (var i = 0; i < oldLetters.length; i++) {
        if (oldLetters[i] !== newLetters[i]) {
          return newLetters[i];
        }
      }
      return newLetters[newLetters.length - 1];
    }

    function reset(preserveWord = false) {
      [...document.querySelectorAll('.used-tile')].map((usedTile) => {
        usedTile.classList.remove('used-tile');
      });
      // [...document.querySelectorAll('.hidden-tile')].map((hiddenTile) => {
      //   hiddenTile.remove();
      // })
      // var word = document.getElementById('wordTarget');
      // var tiles = document.getElementById('tileArea');
      // while (word.childNodes.length > 0) {
      //   word.lastChild.classList.remove("bounce");
      //   tiles.prepend(word.lastChild);
      // }
      currentWord = "";
      if (!preserveWord) {
        document.querySelector(`#solution-${currentRound + 4}`).innerText = "";
      }
    }

    function shuffle() {
      var tiles = document.getElementById('tileArea');
      while (true) {
        for (var i = currentRound + 4; i >= 0; i--) {
          tiles.insertBefore(tiles.children[Math.random() * i | 0], tiles.children[currentRound + 4]);
        }
        if (!solution.flat().includes([...tiles.children].slice(0, currentRound + 4).map((child) => child.innerText).join('').toLowerCase())) {
          break;
        }
      }
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = "none";
    }

    function openModal(modalId) {
      document.getElementById(modalId).style.display = "block";
    }
  </script>
</body>

</html>